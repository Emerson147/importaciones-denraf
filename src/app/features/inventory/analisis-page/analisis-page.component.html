<div class="min-h-screen bg-stone-50 dark:bg-stone-950 p-6 md:p-8 transition-colors duration-100">
  <div class="max-w-[1600px] mx-auto space-y-6">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="text-4xl">üì¶</div>
        <div>
          <h1 class="text-3xl font-serif font-bold text-stone-800 dark:text-stone-100">Inventario Inteligente</h1>
          <p class="text-stone-500 dark:text-stone-400 text-sm font-light">Modelo feria ‚Ä¢ Hoy {{ currentDate() }}</p>
        </div>
      </div>
    </div>

    <!-- üí∞ SECCI√ìN 1: SALUD DEL CAPITAL -->
    <div class="bg-gradient-to-br from-stone-900 to-stone-800 dark:from-stone-950 dark:to-stone-900 text-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all">
      <div class="px-6 py-5 border-b border-white/10">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-xl bg-white/10 backdrop-blur flex items-center justify-center">
            <span class="material-icons-outlined text-xl">account_balance_wallet</span>
          </div>
          <div>
            <h2 class="text-xl font-bold">Salud Financiera</h2>
            <p class="text-stone-300 text-xs">Capital invertido y liquidez</p>
          </div>
        </div>
      </div>

      <div class="p-6">
        <!-- M√©tricas de Capital -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-5">
          <div class="bg-white/10 backdrop-blur rounded-xl p-4 hover:bg-white/15 transition-all">
            <p class="text-xs text-stone-300 uppercase tracking-wide font-medium mb-1">Total</p>
            <p class="text-3xl font-bold">S/ {{ capitalHealth().totalInvested | number:'1.0-0' }}</p>
            <p class="text-xs text-stone-400 mt-1">{{ metrics().totalProducts }} prod.</p>
          </div>

          <div class="bg-emerald-500/20 backdrop-blur rounded-xl p-4 border border-emerald-500/30 hover:bg-emerald-500/25 transition-all">
            <p class="text-xs text-emerald-200 uppercase tracking-wide font-medium mb-1">‚úÖ Activo</p>
            <p class="text-3xl font-bold text-emerald-300">S/ {{ capitalHealth().activeCapital | number:'1.0-0' }}</p>
            <p class="text-xs text-emerald-300/70 mt-1">&lt;30 d√≠as</p>
          </div>

          <div class="bg-amber-500/20 backdrop-blur rounded-xl p-4 border border-amber-500/30 hover:bg-amber-500/25 transition-all">
            <p class="text-xs text-amber-200 uppercase tracking-wide font-medium mb-1">‚ö†Ô∏è Lento</p>
            <p class="text-3xl font-bold text-amber-300">S/ {{ capitalHealth().slowCapital | number:'1.0-0' }}</p>
            <p class="text-xs text-amber-300/70 mt-1">30-60 d√≠as</p>
          </div>

          <div class="bg-red-500/20 backdrop-blur rounded-xl p-4 border border-red-500/30 hover:bg-red-500/25 transition-all">
            <p class="text-xs text-red-200 uppercase tracking-wide font-medium mb-1">üî¥ Congelado</p>
            <p class="text-3xl font-bold text-red-300">S/ {{ capitalHealth().frozenCapital | number:'1.0-0' }}</p>
            <p class="text-xs text-red-300/70 mt-1">&gt;60 d√≠as</p>
          </div>
        </div>

        <!-- Indicador de Liquidez -->
        <div class="bg-white/10 backdrop-blur rounded-xl p-4 hover:bg-white/15 transition-all">
          <div class="flex items-center justify-between mb-2">
            <div>
              <p class="text-sm font-medium">Liquidez</p>
              <p class="text-xs text-stone-300">% congelado</p>
            </div>
            <div class="text-right">
              <p class="text-2xl font-bold">{{ capitalHealth().liquidityRatio | number:'1.0-0' }}%</p>
              <p class="text-xs"
                 [ngClass]="{
                   'text-emerald-300': capitalHealth().liquidityRatio < 20,
                   'text-amber-300': capitalHealth().liquidityRatio >= 20 && capitalHealth().liquidityRatio < 40,
                   'text-red-300': capitalHealth().liquidityRatio >= 40
                 }">
                @if (capitalHealth().liquidityRatio < 20) { Excelente }
                @else if (capitalHealth().liquidityRatio < 40) { Moderado }
                @else { Cr√≠tico }
              </p>
            </div>
          </div>
          
          <div class="h-2.5 bg-white/20 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-emerald-500 via-amber-500 to-red-500 rounded-full transition-all duration-500"
                 [style.width.%]="capitalHealth().liquidityRatio"></div>
          </div>

          @if (capitalHealth().liquidityRatio > 30) {
            <div class="mt-3 p-3 bg-red-500/20 rounded-lg border border-red-500/30">
              <p class="text-xs font-medium flex items-center gap-2">
                <span class="material-icons-outlined text-sm">warning</span>
                Meta: Libera <span class="font-bold">S/ {{ capitalHealth().targetLiberation | number:'1.0-0' }}</span> en 60 d√≠as
              </p>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- üî• SECCI√ìN 2: LIQUIDACI√ìN INTELIGENTE -->
    @if (liquidationSuggestions().length > 0) {
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
        <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 rounded-xl bg-red-50 dark:bg-red-950/30 flex items-center justify-center text-red-600 dark:text-red-500">
              <span class="material-icons-outlined text-xl">local_fire_department</span>
            </div>
            <div>
              <h2 class="text-xl font-bold text-stone-800 dark:text-stone-100">Liquidaci√≥n Urgente</h2>
              <p class="text-xs text-stone-500 dark:text-stone-400">Plan de recuperaci√≥n progresivo</p>
            </div>
          </div>
          <span class="px-3 py-1.5 rounded-full bg-red-50 dark:bg-red-950/30 text-red-700 dark:text-red-500 text-xs font-bold">
            {{ liquidationSuggestions().length }}
          </span>
        </div>

        <div class="p-6">
          <!-- Vista m√≥vil: Cards -->
          <div class="sm:hidden space-y-3">
            @for (suggestion of liquidationSuggestions().slice(0, 10); track suggestion.product.id) {
              <div class="bg-red-50/30 dark:bg-red-950/20 rounded-xl border border-red-100 dark:border-red-900/30 p-4">
                <div class="flex items-start justify-between mb-3">
                  <div class="flex-1">
                    <p class="font-bold text-sm text-stone-900 dark:text-stone-100">{{ suggestion.product.name }}</p>
                    <p class="text-xs text-stone-500 dark:text-stone-400 mt-0.5">
                      {{ suggestion.fairsWithoutSale }} ferias ({{ suggestion.daysWithoutSale }}d)
                    </p>
                  </div>
                  <span class="px-2.5 py-1 rounded-lg bg-red-600 text-white text-xs font-bold">
                    {{ suggestion.fairsWithoutSale }}f
                  </span>
                </div>

                <div class="grid grid-cols-2 gap-2 mb-3">
                  <div class="bg-white dark:bg-stone-800 rounded-lg p-2.5">
                    <p class="text-xs text-stone-500 dark:text-stone-400">Costo</p>
                    <p class="text-sm font-bold text-stone-900 dark:text-stone-100">S/ {{ suggestion.costPrice | number:'1.0-0' }}</p>
                  </div>
                  <div class="bg-white dark:bg-stone-800 rounded-lg p-2.5">
                    <p class="text-xs text-stone-500 dark:text-stone-400">Actual</p>
                    <p class="text-sm font-bold text-stone-900 dark:text-stone-100">S/ {{ suggestion.currentPrice | number:'1.0-0' }}</p>
                  </div>
                </div>

                <div class="bg-white dark:bg-stone-800 rounded-lg p-3 space-y-2">
                  <p class="text-xs font-bold text-stone-600 dark:text-stone-400">Plan de liquidaci√≥n:</p>
                  <div class="flex items-center justify-between text-xs">
                    <span class="text-stone-600 dark:text-stone-400">Semana 1-2 (-20%):</span>
                    <span class="font-bold text-stone-900 dark:text-stone-100">
                      S/ {{ suggestion.liquidationPlan.week1.price | number:'1.0-0' }}
                      <span class="text-emerald-600 dark:text-emerald-500 ml-1">(+{{ suggestion.liquidationPlan.week1.profit | number:'1.0-0' }})</span>
                    </span>
                  </div>
                  <div class="flex items-center justify-between text-xs">
                    <span class="text-stone-600 dark:text-stone-400">Semana 3-4 (-30%):</span>
                    <span class="font-bold text-stone-900 dark:text-stone-100">
                      S/ {{ suggestion.liquidationPlan.week2.price | number:'1.0-0' }}
                      <span class="text-amber-600 dark:text-amber-500 ml-1">(+{{ suggestion.liquidationPlan.week2.profit | number:'1.0-0' }})</span>
                    </span>
                  </div>
                  <div class="flex items-center justify-between text-xs">
                    <span class="text-stone-600 dark:text-stone-400">Semana 5+ (-40%):</span>
                    <span class="font-bold text-stone-900 dark:text-stone-100">
                      S/ {{ suggestion.liquidationPlan.week3.price | number:'1.0-0' }}
                      <span class="text-red-600 dark:text-red-500 ml-1">(+{{ suggestion.liquidationPlan.week3.profit | number:'1.0-0' }})</span>
                    </span>
                  </div>
                </div>

                <div class="mt-3 pt-3 border-t border-red-100 dark:border-red-900/30 flex items-center justify-between text-xs">
                  <span class="text-stone-500 dark:text-stone-400">Congelado:</span>
                  <span class="font-bold text-red-600 dark:text-red-500">S/ {{ suggestion.frozenCapital | number:'1.0-0' }}</span>
                </div>
              </div>
            }
          </div>

          <!-- Vista desktop: Tabla -->
          <div class="hidden sm:block overflow-x-auto -mx-6">
            <table class="w-full">
              <thead class="bg-stone-50 dark:bg-stone-900/50 border-y border-stone-100 dark:border-stone-800">
                <tr>
                  <th class="text-left px-6 py-3 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide">Producto</th>
                  <th class="text-left px-6 py-3 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide">Ferias</th>
                  <th class="text-left px-6 py-3 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide">Costo/Precio</th>
                  <th class="text-left px-6 py-3 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide">-20%</th>
                  <th class="text-left px-6 py-3 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide">-30%</th>
                  <th class="text-left px-6 py-3 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide">-40%</th>
                  <th class="text-left px-6 py-3 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide">Congelado</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-stone-100 dark:divide-stone-800">
                @for (suggestion of liquidationSuggestions().slice(0, 10); track suggestion.product.id) {
                  <tr class="hover:bg-stone-50 dark:hover:bg-stone-900/30 transition-colors duration-100">
                    <td class="px-6 py-4">
                      <p class="text-sm font-medium text-stone-900 dark:text-stone-100">{{ suggestion.product.name }}</p>
                      <p class="text-xs text-stone-500 dark:text-stone-400">Stock: {{ suggestion.product.stock }}</p>
                    </td>
                    <td class="px-6 py-4">
                      <span class="inline-flex items-center px-2.5 py-1 rounded-lg bg-red-50 dark:bg-red-950/30 text-red-700 dark:text-red-500 text-xs font-bold">
                        {{ suggestion.fairsWithoutSale }}
                      </span>
                      <p class="text-xs text-stone-400 dark:text-stone-500 mt-1">{{ suggestion.daysWithoutSale }}d</p>
                    </td>
                    <td class="px-6 py-4">
                      <p class="text-xs text-stone-500 dark:text-stone-400">S/ {{ suggestion.costPrice | number:'1.0-0' }}</p>
                      <p class="text-sm font-bold text-stone-900 dark:text-stone-100">S/ {{ suggestion.currentPrice | number:'1.0-0' }}</p>
                    </td>
                    <td class="px-6 py-4">
                      <p class="text-sm font-bold text-stone-900 dark:text-stone-100">S/ {{ suggestion.liquidationPlan.week1.price | number:'1.0-0' }}</p>
                      <p class="text-xs text-emerald-600 dark:text-emerald-500">+{{ suggestion.liquidationPlan.week1.profit | number:'1.0-0' }}</p>
                    </td>
                    <td class="px-6 py-4">
                      <p class="text-sm font-bold text-stone-900 dark:text-stone-100">S/ {{ suggestion.liquidationPlan.week2.price | number:'1.0-0' }}</p>
                      <p class="text-xs text-amber-600 dark:text-amber-500">+{{ suggestion.liquidationPlan.week2.profit | number:'1.0-0' }}</p>
                    </td>
                    <td class="px-6 py-4">
                      <p class="text-sm font-bold text-stone-900 dark:text-stone-100">S/ {{ suggestion.liquidationPlan.week3.price | number:'1.0-0' }}</p>
                      <p class="text-xs text-red-600 dark:text-red-500">+{{ suggestion.liquidationPlan.week3.profit | number:'1.0-0' }}</p>
                    </td>
                    <td class="px-6 py-4">
                      <p class="text-sm font-bold text-red-600 dark:text-red-500">S/ {{ suggestion.frozenCapital | number:'1.0-0' }}</p>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    }

    <!-- üìä SECCI√ìN 3: CLASIFICACI√ìN DE PRODUCTOS -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
      <!-- Productos B√°sicos -->
      @if (basicProducts().length > 0) {
        <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
          <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800">
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-xl bg-emerald-50 dark:bg-emerald-950/30 flex items-center justify-center text-emerald-600 dark:text-emerald-500">
                <span class="material-icons-outlined text-xl">autorenew</span>
              </div>
              <div>
                <h3 class="text-lg font-bold text-stone-800 dark:text-stone-100">B√°sicos</h3>
                <p class="text-xs text-stone-500 dark:text-stone-400">Alta rotaci√≥n</p>
              </div>
            </div>
          </div>

          <div class="p-4 space-y-2 max-h-96 overflow-y-auto">
            @for (classification of basicProducts().slice(0, 10); track classification.product.id) {
              <div class="bg-emerald-50/30 dark:bg-emerald-950/20 rounded-xl p-3 border border-emerald-100 dark:border-emerald-900/30 hover:bg-emerald-50/50 dark:hover:bg-emerald-950/30 transition-colors">
                <div class="flex items-start justify-between mb-2">
                  <p class="text-sm font-bold text-stone-900 dark:text-stone-100 flex-1 leading-tight pr-2">{{ classification.product.name }}</p>
                  @if (classification.shouldReorder) {
                    <span class="px-2 py-0.5 rounded-lg bg-emerald-600 text-white text-xs font-bold flex-shrink-0">‚Üª</span>
                  }
                </div>
                <div class="grid grid-cols-2 gap-3 text-xs">
                  <div>
                    <span class="text-stone-500 dark:text-stone-400">Rotaci√≥n:</span>
                    <span class="font-bold text-emerald-700 dark:text-emerald-600 ml-1">{{ classification.rotationPerFair | number:'1.1-1' }}/f</span>
                  </div>
                  <div>
                    <span class="text-stone-500 dark:text-stone-400">Stock:</span>
                    <span class="font-bold text-stone-900 dark:text-stone-100 ml-1">{{ classification.product.stock }}</span>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Productos de Variedad -->
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
        <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 rounded-xl bg-sky-50 dark:bg-sky-950/30 flex items-center justify-center text-sky-600 dark:text-sky-500">
              <span class="material-icons-outlined text-xl">palette</span>
            </div>
            <div>
              <h3 class="text-lg font-bold text-stone-800 dark:text-stone-100">Variedad</h3>
              <p class="text-xs text-stone-500 dark:text-stone-400">Media rotaci√≥n</p>
            </div>
          </div>
        </div>

        <div class="p-4 space-y-2 max-h-96 overflow-y-auto">
          @for (classification of productClassifications(); track classification.product.id) {
            @if (classification.classification === 'variedad') {
              <div class="bg-sky-50/30 dark:bg-sky-950/20 rounded-xl p-3 border border-sky-100 dark:border-sky-900/30 hover:bg-sky-50/50 dark:hover:bg-sky-950/30 transition-colors">
                <p class="text-sm font-bold text-stone-900 dark:text-stone-100 mb-2 leading-tight">{{ classification.product.name }}</p>
                <div class="grid grid-cols-2 gap-3 text-xs">
                  <div>
                    <span class="text-stone-500 dark:text-stone-400">Rotaci√≥n:</span>
                    <span class="font-bold text-sky-700 dark:text-sky-600 ml-1">{{ classification.rotationPerFair | number:'1.1-1' }}/f</span>
                  </div>
                  <div>
                    <span class="text-stone-500 dark:text-stone-400">Sin venta:</span>
                    <span class="font-bold text-stone-900 dark:text-stone-100 ml-1">{{ classification.fairsSinceLastSale }}f</span>
                  </div>
                </div>
              </div>
            }
          }
        </div>
      </div>

      <!-- Productos Estancados -->
      @if (frozenProducts().length > 0) {
        <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
          <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800">
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-xl bg-red-50 dark:bg-red-950/30 flex items-center justify-center text-red-600 dark:text-red-500">
                <span class="material-icons-outlined text-xl">ac_unit</span>
              </div>
              <div>
                <h3 class="text-lg font-bold text-stone-800 dark:text-stone-100">Estancados</h3>
                <p class="text-xs text-stone-500 dark:text-stone-400">&gt;8 ferias sin venta</p>
              </div>
            </div>
          </div>

          <div class="p-4 space-y-2 max-h-96 overflow-y-auto">
            @for (classification of frozenProducts().slice(0, 10); track classification.product.id) {
              <div class="bg-red-50/30 dark:bg-red-950/20 rounded-xl p-3 border border-red-100 dark:border-red-900/30 hover:bg-red-50/50 dark:hover:bg-red-950/30 transition-colors">
                <div class="flex items-start justify-between mb-2">
                  <p class="text-sm font-bold text-stone-900 dark:text-stone-100 flex-1 leading-tight pr-2">{{ classification.product.name }}</p>
                  <span class="px-2 py-0.5 rounded-lg bg-red-600 text-white text-xs font-bold flex-shrink-0">!</span>
                </div>
                <div class="grid grid-cols-2 gap-3 text-xs">
                  <div>
                    <span class="text-stone-500 dark:text-stone-400">Sin venta:</span>
                    <span class="font-bold text-red-700 dark:text-red-600 ml-1">{{ classification.fairsSinceLastSale }}f</span>
                  </div>
                  <div>
                    <span class="text-stone-500 dark:text-stone-400">Stock:</span>
                    <span class="font-bold text-stone-900 dark:text-stone-100 ml-1">{{ classification.product.stock }}</span>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>

    <!-- üéØ SECCI√ìN 4: M√âTRICAS R√ÅPIDAS -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
      <!-- Valor Total -->
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm p-6 hover:shadow-md transition-all">
        <div class="flex items-center gap-2.5 mb-3">
          <div class="h-10 w-10 rounded-xl bg-stone-100 dark:bg-stone-800 flex items-center justify-center">
            <span class="material-icons-outlined text-stone-600 dark:text-stone-400">inventory_2</span>
          </div>
          <p class="text-xs uppercase tracking-wide font-medium text-stone-500 dark:text-stone-400">Valor</p>
        </div>
        <p class="text-3xl font-bold text-stone-900 dark:text-stone-100 mb-1">S/ {{ metrics().totalValue | number:'1.0-0' }}</p>
        <p class="text-xs text-stone-500 dark:text-stone-400">{{ metrics().totalProducts }} productos</p>
      </div>

      <!-- Cr√≠ticos -->
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm p-6 hover:shadow-md transition-all">
        <div class="flex items-center gap-2.5 mb-3">
          <div class="h-10 w-10 rounded-xl bg-red-50 dark:bg-red-950/30 flex items-center justify-center">
            <span class="material-icons-outlined text-red-600 dark:text-red-500">error_outline</span>
          </div>
          <p class="text-xs uppercase tracking-wide font-medium text-stone-500 dark:text-stone-400">Cr√≠ticos</p>
        </div>
        <p class="text-3xl font-bold text-red-600 dark:text-red-500 mb-1">{{ metrics().criticalProducts }}</p>
        <p class="text-xs text-stone-500 dark:text-stone-400">Atenci√≥n urgente</p>
      </div>

      <!-- Rotaci√≥n -->
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm p-6 hover:shadow-md transition-all">
        <div class="flex items-center gap-2.5 mb-3">
          <div class="h-10 w-10 rounded-xl bg-stone-100 dark:bg-stone-800 flex items-center justify-center">
            <span class="material-icons-outlined text-stone-600 dark:text-stone-400">autorenew</span>
          </div>
          <p class="text-xs uppercase tracking-wide font-medium text-stone-500 dark:text-stone-400">Rotaci√≥n</p>
        </div>
        <p class="text-3xl font-bold text-stone-900 dark:text-stone-100 mb-1">{{ metrics().averageRotation | number:'1.2-2' }}</p>
        <p class="text-xs text-stone-500 dark:text-stone-400">und/d√≠a promedio</p>
      </div>

      <!-- Alertas -->
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm p-6 hover:shadow-md transition-all">
        <div class="flex items-center gap-2.5 mb-3">
          <div class="h-10 w-10 rounded-xl bg-amber-50 dark:bg-amber-950/30 flex items-center justify-center">
            <span class="material-icons-outlined text-amber-600 dark:text-amber-500">notifications_active</span>
          </div>
          <p class="text-xs uppercase tracking-wide font-medium text-stone-500 dark:text-stone-400">Alertas</p>
        </div>
        <p class="text-3xl font-bold text-amber-600 dark:text-amber-500 mb-1">{{ stockAlerts().length }}</p>
        <p class="text-xs text-stone-500 dark:text-stone-400">{{ highPriorityAlertsCount() }} alta prioridad</p>
      </div>
    </div>

    <!-- üéØ SECCI√ìN 5: ALERTAS ACTIVAS -->
    @if (stockAlerts().length > 0) {
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
        <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800 flex items-center justify-between">
          <h2 class="text-lg font-bold text-stone-800 dark:text-stone-100">Alertas de Stock</h2>
          <span class="px-3 py-1.5 rounded-full bg-stone-100 dark:bg-stone-800 text-stone-600 dark:text-stone-400 text-xs font-medium">
            {{ stockAlerts().length }} activas
          </span>
        </div>
        
        <div class="p-6 space-y-3">
          @for (alert of stockAlerts().slice(0, 5); track alert.id) {
            <div class="flex items-center gap-4 p-4 rounded-xl border hover:shadow-sm transition-all"
                 [ngClass]="{
                   'bg-red-50/30 dark:bg-red-950/20 border-red-100 dark:border-red-900/30': alert.alertType === 'critical' || alert.alertType === 'stockout',
                   'bg-amber-50/30 dark:bg-amber-950/20 border-amber-100 dark:border-amber-900/30': alert.alertType === 'low',
                   'bg-stone-50 dark:bg-stone-900/50 border-stone-100 dark:border-stone-800': alert.alertType === 'overstock'
                 }">
              <div class="h-10 w-10 rounded-xl flex items-center justify-center flex-shrink-0"
                   [ngClass]="{
                     'bg-red-600 dark:bg-red-600/80 text-white': alert.alertType === 'critical' || alert.alertType === 'stockout',
                     'bg-amber-600 dark:bg-amber-600/80 text-white': alert.alertType === 'low',
                     'bg-stone-600 text-white': alert.alertType === 'overstock'
                   }">
                <span class="material-icons-outlined">
                  @if (alert.alertType === 'stockout') { inventory }
                  @else if (alert.alertType === 'critical') { error_outline }
                  @else if (alert.alertType === 'low') { warning }
                  @else { info }
                </span>
              </div>
              
              <div class="flex-1 min-w-0">
                <p class="font-semibold text-sm text-stone-800 dark:text-stone-100 truncate">{{ alert.product.name }}</p>
                <p class="text-xs text-stone-600 dark:text-stone-400 truncate">{{ alert.message }}</p>
              </div>
              
              <div class="text-right flex-shrink-0">
                <p class="text-xs text-stone-500 dark:text-stone-400 mb-0.5">Stock</p>
                <p class="text-xl font-bold"
                   [ngClass]="{
                     'text-red-600 dark:text-red-500': alert.product.stock === 0,
                     'text-amber-600 dark:text-amber-500': alert.product.stock > 0 && alert.product.stock <= 3,
                     'text-stone-900 dark:text-stone-100': alert.product.stock > 3
                   }">
                  {{ alert.product.stock }}
                </p>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- üéØ SECCI√ìN 6: GR√ÅFICOS -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
      <!-- Rotaci√≥n -->
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm p-6 hover:shadow-md transition-all">
        <div class="mb-6">
          <h2 class="text-lg font-bold text-stone-800 dark:text-stone-100">Rotaci√≥n de Productos</h2>
          <p class="text-xs text-stone-500 dark:text-stone-400 mt-1">Top 10 m√°s vendidos</p>
        </div>
        
        <apx-chart
          [series]="rotationChartOptions().series!"
          [chart]="rotationChartOptions().chart!"
          [plotOptions]="rotationChartOptions().plotOptions!"
          [xaxis]="rotationChartOptions().xaxis!"
          [yaxis]="rotationChartOptions().yaxis!"
          [colors]="rotationChartOptions().colors!"
          [grid]="rotationChartOptions().grid!"
          [tooltip]="rotationChartOptions().tooltip!"
          [dataLabels]="rotationChartOptions().dataLabels!"
        ></apx-chart>
      </div>

      <!-- Estado -->
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm p-6 hover:shadow-md transition-all">
        <div class="mb-6">
          <h2 class="text-lg font-bold text-stone-800 dark:text-stone-100">Estado del Inventario</h2>
          <p class="text-xs text-stone-500 dark:text-stone-400 mt-1">Distribuci√≥n por estado</p>
        </div>
        
        <apx-chart
          [series]="inventoryStatusChartOptions().series!"
          [chart]="inventoryStatusChartOptions().chart!"
          [labels]="inventoryStatusChartOptions().labels!"
          [colors]="inventoryStatusChartOptions().colors!"
          [plotOptions]="inventoryStatusChartOptions().plotOptions!"
          [legend]="inventoryStatusChartOptions().legend!"
          [dataLabels]="inventoryStatusChartOptions().dataLabels!"
        ></apx-chart>
      </div>
    </div>

    <!-- üéØ SECCI√ìN 7: REABASTECIMIENTO -->
    @if (reorderSuggestions().length > 0) {
      <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
        <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800 flex items-center justify-between">
          <div>
            <h2 class="text-lg font-bold text-stone-800 dark:text-stone-100">Reabastecimiento</h2>
            <p class="text-xs text-stone-500 dark:text-stone-400 mt-1">Productos prioritarios</p>
          </div>
          <span class="px-3 py-1.5 rounded-full bg-stone-100 dark:bg-stone-800 text-stone-700 dark:text-stone-300 text-xs font-bold">
            {{ reorderSuggestions().length }}
          </span>
        </div>
        
        <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
          @for (suggestion of reorderSuggestions().slice(0, 6); track suggestion.product.id) {
            <div class="p-4 rounded-xl border border-stone-100 dark:border-stone-800 bg-stone-50 dark:bg-stone-800/50 hover:shadow-sm transition-all">
              <div class="flex items-start justify-between mb-3">
                <div class="flex-1 min-w-0">
                  <p class="font-bold text-sm text-stone-900 dark:text-stone-100 truncate">{{ suggestion.product.name }}</p>
                  <p class="text-xs text-stone-500 dark:text-stone-400 truncate">{{ suggestion.product.category }}</p>
                </div>
                @if (suggestion.product.stock === 0) {
                  <span class="px-2 py-1 rounded-lg bg-red-600 text-white text-xs font-bold flex-shrink-0">0</span>
                }
                @else if (suggestion.status === 'critical') {
                  <span class="px-2 py-1 rounded-lg bg-amber-600 text-white text-xs font-bold flex-shrink-0">!</span>
                }
              </div>
              
              <div class="space-y-2 mb-3">
                <div class="flex justify-between text-xs">
                  <span class="text-stone-600 dark:text-stone-400">Stock:</span>
                  <span class="font-bold text-stone-900 dark:text-stone-100">{{ suggestion.product.stock }}</span>
                </div>
                <div class="flex justify-between text-xs">
                  <span class="text-stone-600 dark:text-stone-400">D√≠as rest.:</span>
                  <span class="font-bold text-stone-800 dark:text-stone-200">
                    @if (!isFinite(suggestion.daysUntilStockout)) { ‚àû }
                    @else { {{ suggestion.daysUntilStockout | number:'1.0-0' }}d }
                  </span>
                </div>
                <div class="flex justify-between text-xs">
                  <span class="text-stone-600 dark:text-stone-400">Rotaci√≥n:</span>
                  <span class="font-bold text-stone-900 dark:text-stone-100">{{ suggestion.rotationRate | number:'1.2-2' }}/d</span>
                </div>
              </div>
              
              <div class="pt-3 border-t border-stone-200 dark:border-stone-700 flex items-center justify-between">
                <span class="text-xs text-stone-500 dark:text-stone-400">Reordenar:</span>
                <span class="text-2xl font-bold text-stone-900 dark:text-stone-100">{{ suggestion.reorderQuantity }}</span>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- üéØ SECCI√ìN 8: PRODUCTOS DESTACADOS -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
      <!-- Cr√≠ticos -->
      @if (criticalProducts().length > 0) {
        <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
          <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800">
            <h2 class="text-lg font-bold text-stone-800 dark:text-stone-100">Productos Cr√≠ticos</h2>
            <p class="text-xs text-stone-500 dark:text-stone-400 mt-1">Stock bajo o agotado</p>
          </div>
          
          <div class="p-6 space-y-3">
            @for (analysis of criticalProducts().slice(0, 5); track analysis.product.id) {
              <div class="flex items-center gap-4 p-4 rounded-xl bg-red-50/30 dark:bg-red-950/20 border border-red-100 dark:border-red-900/30 hover:bg-red-50/50 dark:hover:bg-red-950/30 transition-colors">
                <div class="h-12 w-12 rounded-xl bg-red-600 dark:bg-red-600/80 flex items-center justify-center text-white font-bold text-lg flex-shrink-0">
                  {{ analysis.product.stock }}
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-sm text-stone-900 dark:text-stone-100 truncate">{{ analysis.product.name }}</p>
                  <p class="text-xs text-stone-500 dark:text-stone-400 truncate">
                    @if (analysis.product.stock === 0) { Agotado }
                    @else { {{ analysis.daysUntilStockout }}d hasta agotamiento }
                  </p>
                </div>
                <div class="text-right flex-shrink-0">
                  <p class="text-sm font-bold text-stone-900 dark:text-stone-100">+{{ analysis.reorderQuantity }}</p>
                  <p class="text-xs text-stone-500 dark:text-stone-400">reorden</p>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Alta Demanda -->
      @if (highDemandProducts().length > 0) {
        <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all">
          <div class="px-6 py-5 border-b border-stone-100 dark:border-stone-800">
            <h2 class="text-lg font-bold text-stone-800 dark:text-stone-100">Alta Demanda</h2>
            <p class="text-xs text-stone-500 dark:text-stone-400 mt-1">M√°s vendidos</p>
          </div>
          
          <div class="p-6 space-y-3">
            @for (analysis of highDemandProducts().slice(0, 5); track analysis.product.id; let i = $index) {
              <div class="flex items-center gap-4 p-4 rounded-xl bg-stone-50 dark:bg-stone-800/50 border border-stone-100 dark:border-stone-700 hover:shadow-sm transition-all">
                <div class="h-12 w-12 rounded-xl flex items-center justify-center font-bold text-lg text-white flex-shrink-0"
                     [ngClass]="{
                       'bg-stone-900 dark:bg-stone-800': i === 0,
                       'bg-stone-700 dark:bg-stone-700': i === 1,
                       'bg-stone-600 dark:bg-stone-600': i === 2,
                       'bg-stone-500 dark:bg-stone-500': i > 2
                     }">
                  #{{ i + 1 }}
                </div>
                <div class="flex-1 min-w-0">
                  <p class="font-semibold text-sm text-stone-900 dark:text-stone-100 truncate">{{ analysis.product.name }}</p>
                  <p class="text-xs text-stone-500 dark:text-stone-400 truncate">{{ analysis.totalSold }} und ‚Ä¢ S/ {{ analysis.revenue | number:'1.0-0' }}</p>
                </div>
                <div class="text-right flex-shrink-0">
                  <p class="text-sm font-bold text-stone-900 dark:text-stone-100">{{ analysis.rotationRate | number:'1.2-2' }}</p>
                  <p class="text-xs text-stone-500 dark:text-stone-400">und/d</p>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>

  </div>
</div>
