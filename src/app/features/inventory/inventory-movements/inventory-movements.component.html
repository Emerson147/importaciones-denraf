<div class="min-h-screen bg-stone-50 dark:bg-stone-950 p-6 md:p-8 transition-colors duration-100">
  <div class="max-w-[1600px] mx-auto space-y-6">
    <!-- Header Estandarizado con ui-page-header -->
    <app-ui-page-header
      title="Entradas de Stock"
      subtitle="DenRaf · Control de recepción de mercadería"
      materialIcon="local_shipping"
    >
      <button
        (click)="openNewMovementDialog()"
        class="rounded-xl bg-stone-900 dark:bg-stone-100 hover:bg-black dark:hover:bg-stone-200 text-white dark:text-stone-900 px-6 py-2.5 shadow-lg font-medium transition-colors duration-150 flex items-center gap-2"
      >
        <span class="material-icons-outlined text-sm">add</span>
        Nueva Entrada
      </button>
    </app-ui-page-header>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div
        class="group bg-white dark:bg-stone-900 rounded-2xl p-6 border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-lg transition-all duration-300 ease-out hover:scale-[1.01] hover:-translate-y-0.5 cursor-pointer"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-stone-500 dark:text-stone-400">Entradas Hoy</p>
            <p
              class="text-3xl font-bold text-emerald-700 dark:text-emerald-600 mt-2 group-hover:scale-105 transition-transform duration-200 ease-out transform-gpu"
            >
              {{ todayEntradas() }}
            </p>
          </div>
          <div
            class="w-14 h-14 rounded-xl bg-emerald-50 dark:bg-emerald-950/20 flex items-center justify-center"
          >
            <span
              class="material-icons-outlined text-2xl text-emerald-700 dark:text-emerald-600 group-hover:rotate-6 group-hover:scale-110 transition-transform duration-200 ease-out"
              >arrow_downward</span
            >
          </div>
        </div>
      </div>

      <div
        class="group bg-white dark:bg-stone-900 rounded-2xl p-6 border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-lg transition-all duration-300 ease-out hover:scale-[1.01] hover:-translate-y-0.5 cursor-pointer"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-stone-500 dark:text-stone-400">Ajustes Hoy</p>
            <p
              class="text-3xl font-bold text-sky-700 dark:text-sky-600 mt-2 group-hover:scale-105 transition-transform duration-200 ease-out transform-gpu"
            >
              {{ todayAjustes() }}
            </p>
          </div>
          <div
            class="w-14 h-14 rounded-xl bg-sky-50 dark:bg-sky-950/20 flex items-center justify-center"
          >
            <span
              class="material-icons-outlined text-2xl text-sky-700 dark:text-sky-600 group-hover:rotate-6 group-hover:scale-110 transition-transform duration-200 ease-out"
              >tune</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Filtros y búsqueda -->
    <div
      class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm overflow-hidden transition-colors duration-100"
    >
      <div
        class="p-6 border-b border-stone-50 dark:border-stone-800 flex flex-col md:flex-row items-center justify-between gap-4"
      >
        <!-- Search -->
        <div class="flex items-center gap-4 flex-1 w-full md:w-auto">
          <div class="relative flex-1 max-w-md">
            <span
              class="absolute left-3 top-1/2 -translate-y-1/2 material-icons-outlined text-stone-400 dark:text-stone-500 text-lg"
              >search</span
            >
            <input
              type="text"
              [(ngModel)]="searchQuery"
              placeholder="Buscar producto o número..."
              class="w-full pl-10 pr-4 py-2.5 bg-stone-50 dark:bg-stone-950 border border-transparent rounded-xl focus:outline-none focus:ring-2 focus:ring-stone-300 dark:focus:ring-stone-600 text-sm text-stone-900 dark:text-stone-100 transition-colors duration-100"
            />
          </div>

          <div class="flex items-center gap-2 text-xs text-stone-500 dark:text-stone-400">
            <span class="material-icons-outlined text-sm">filter_list</span>
            <span>{{ filteredMovements().length }} entradas</span>
          </div>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2">
          <button
            (click)="selectedTab.set('all')"
            [class.bg-stone-900]="selectedTab() === 'all'"
            [class.dark:bg-stone-100]="selectedTab() === 'all'"
            [class.text-white]="selectedTab() === 'all'"
            [class.dark:text-stone-900]="selectedTab() === 'all'"
            [class.bg-stone-100]="selectedTab() !== 'all'"
            [class.dark:bg-stone-800]="selectedTab() !== 'all'"
            [class.text-stone-600]="selectedTab() !== 'all'"
            [class.dark:text-stone-300]="selectedTab() !== 'all'"
            class="px-4 py-2 rounded-xl text-sm font-medium transition-all duration-200 ease-out hover:scale-[1.02] active:scale-95"
          >
            Todos
          </button>
          <button
            (click)="selectedTab.set('entradas')"
            [class.bg-emerald-700]="selectedTab() === 'entradas'"
            [class.dark:bg-emerald-600]="selectedTab() === 'entradas'"
            [class.text-white]="selectedTab() === 'entradas'"
            [class.bg-stone-100]="selectedTab() !== 'entradas'"
            [class.dark:bg-stone-800]="selectedTab() !== 'entradas'"
            [class.text-stone-600]="selectedTab() !== 'entradas'"
            [class.dark:text-stone-300]="selectedTab() !== 'entradas'"
            class="px-4 py-2 rounded-xl text-sm font-medium transition-colors duration-100"
          >
            Entradas
          </button>
          <button
            (click)="selectedTab.set('ajustes')"
            [class.bg-sky-700]="selectedTab() === 'ajustes'"
            [class.dark:bg-sky-600]="selectedTab() === 'ajustes'"
            [class.text-white]="selectedTab() === 'ajustes'"
            [class.bg-stone-100]="selectedTab() !== 'ajustes'"
            [class.dark:bg-stone-800]="selectedTab() !== 'ajustes'"
            [class.text-stone-600]="selectedTab() !== 'ajustes'"
            [class.dark:text-stone-300]="selectedTab() !== 'ajustes'"
            class="px-4 py-2 rounded-xl text-sm font-medium transition-colors duration-100"
          >
            Ajustes
          </button>
        </div>
      </div>

      <!-- Movements List -->
      @if (loading()) {
      <div class="p-12 text-center">
        <div
          class="w-12 h-12 border-4 border-stone-200 dark:border-stone-700 border-t-stone-900 dark:border-t-stone-100 rounded-full animate-spin mx-auto"
        ></div>
        <p class="text-stone-500 dark:text-stone-400 mt-4">Cargando entradas...</p>
      </div>
      } @else if (filteredMovements().length === 0) {
      <div class="p-12 text-center">
        <span class="material-icons-outlined text-6xl text-stone-300 dark:text-stone-600"
          >shopping_cart</span
        >
        <p class="text-stone-500 dark:text-stone-400 mt-4">No hay entradas registradas</p>
        <button
          (click)="openNewMovementDialog()"
          class="mt-4 text-sm text-stone-700 dark:text-stone-300 hover:text-stone-900 dark:hover:text-stone-100 underline"
        >
          Registrar primera entrada
        </button>
      </div>
      } @else {
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead
            class="bg-stone-50 dark:bg-stone-900/50 border-b border-stone-100 dark:border-stone-800"
          >
            <tr>
              <th
                class="text-left px-6 py-4 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider"
              >
                Número
              </th>
              <th
                class="text-left px-6 py-4 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider"
              >
                Tipo
              </th>
              <th
                class="text-left px-6 py-4 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider"
              >
                Producto
              </th>
              <th
                class="text-left px-6 py-4 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider"
              >
                Cantidad
              </th>
              <th
                class="text-left px-6 py-4 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider"
              >
                Motivo
              </th>
              <th
                class="text-left px-6 py-4 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider"
              >
                Fecha
              </th>
              <th
                class="text-left px-6 py-4 text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider"
              >
                Usuario
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-stone-100 dark:divide-stone-800">
            @for (movement of filteredMovements(); track movement.id) {
            <tr class="hover:bg-stone-50 dark:hover:bg-stone-900/50 transition-colors duration-100">
              <td class="px-6 py-4">
                <span class="text-sm font-medium text-stone-900 dark:text-stone-100 font-mono">{{
                  movement.movementNumber
                }}</span>
              </td>
              <td class="px-6 py-4">
                <span
                  [class]="
                    'inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium ' +
                    getMovementColor(movement.type)
                  "
                >
                  <span class="material-icons-outlined text-base">{{
                    getMovementIcon(movement.type)
                  }}</span>
                  {{ movement.type | titlecase }}
                </span>
              </td>
              <td class="px-6 py-4">
                <div>
                  <p class="text-sm font-medium text-stone-900 dark:text-stone-100">
                    {{ movement.productName }}
                  </p>
                  @if (movement.size || movement.color) {
                  <p class="text-xs text-stone-500 dark:text-stone-400 mt-0.5">
                    {{ movement.size }} @if (movement.color) { / {{ movement.color }} }
                  </p>
                  }
                </div>
              </td>
              <td class="px-6 py-4">
                <span
                  [class]="
                    'text-sm font-bold ' +
                    (movement.type === 'entrada'
                      ? 'text-emerald-700 dark:text-emerald-600'
                      : 'text-sky-700 dark:text-sky-600')
                  "
                >
                  +{{ movement.quantity }}
                </span>
              </td>
              <td class="px-6 py-4">
                <p class="text-sm text-stone-600 dark:text-stone-300">{{ movement.reason }}</p>
                @if (movement.supplier) {
                <p class="text-xs text-stone-500 dark:text-stone-400 mt-0.5">
                  Proveedor: {{ movement.supplier }}
                </p>
                }
              </td>
              <td class="px-6 py-4">
                <span class="text-sm text-stone-500 dark:text-stone-400">{{
                  formatDate(movement.date)
                }}</span>
              </td>
              <td class="px-6 py-4">
                <span class="text-sm text-stone-600 dark:text-stone-300">{{
                  movement.createdBy
                }}</span>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }
    </div>
  </div>
</div>

<!-- Modal Zen: Nueva Entrada de Stock -->
<app-ui-animated-dialog
  [isOpen]="showNewMovementDialog()"
  (isOpenChange)="showNewMovementDialog.set($event)"
>
  <!-- Header Zen con icono -->
  <div
    class="flex items-center justify-between mb-8 border-b border-stone-100 dark:border-stone-800 pb-6"
  >
    <div>
      <h2 class="text-xl font-serif font-semibold text-stone-800 dark:text-stone-100">
        {{ movementType() === 'entrada' ? 'Nueva Entrada de Stock' : 'Ajuste de Inventario' }}
      </h2>
      <p
        class="text-xs text-stone-400 dark:text-stone-500 font-medium tracking-wide uppercase mt-1"
      >
        {{ movementType() === 'entrada' ? 'Recepción de mercadería' : 'Corrección de inventario' }}
      </p>
    </div>
    <div
      class="h-12 w-12 rounded-xl bg-stone-900 dark:bg-stone-100 flex items-center justify-center shadow-lg"
    >
      <span class="material-icons-outlined text-xl text-white dark:text-stone-900">
        {{ movementType() === 'entrada' ? 'local_shipping' : 'tune' }}
      </span>
    </div>
  </div>

  <div class="space-y-6">
    <!-- Tipo de Operación (Visual Cards) -->
    <div>
      <p
        class="text-xs text-stone-400 dark:text-stone-500 font-medium tracking-wide uppercase mb-3"
      >
        Tipo de Operación
      </p>
      <div class="grid grid-cols-2 gap-4">
        <button
          type="button"
          (click)="changeMovementType('entrada')"
          class="group relative p-5 rounded-2xl border-2 transition-all duration-300 flex flex-col items-center gap-3"
          [ngClass]="
            movementType() === 'entrada'
              ? 'bg-emerald-50 dark:bg-emerald-950/30 border-emerald-500 shadow-lg shadow-emerald-100 dark:shadow-emerald-950/20'
              : 'bg-stone-50 dark:bg-stone-800/50 border-stone-200 dark:border-stone-700 hover:border-stone-300 dark:hover:border-stone-600'
          "
        >
          <div
            class="w-14 h-14 rounded-xl flex items-center justify-center transition-all duration-300"
            [ngClass]="
              movementType() === 'entrada'
                ? 'bg-emerald-600 text-white'
                : 'bg-stone-200 dark:bg-stone-700 text-stone-500 dark:text-stone-400 group-hover:bg-stone-300 dark:group-hover:bg-stone-600'
            "
          >
            <span class="material-icons-outlined text-2xl">local_shipping</span>
          </div>
          <div class="text-center">
            <p class="font-semibold text-stone-800 dark:text-stone-100">Entrada</p>
            <p class="text-xs text-stone-500 dark:text-stone-400 mt-0.5">Compra de mercadería</p>
          </div>
          @if (movementType() === 'entrada') {
          <div
            class="absolute -top-1 -right-1 w-6 h-6 bg-emerald-600 rounded-full flex items-center justify-center"
          >
            <span class="material-icons-outlined text-white text-sm">check</span>
          </div>
          }
        </button>

        <button
          type="button"
          (click)="changeMovementType('ajuste')"
          class="group relative p-5 rounded-2xl border-2 transition-all duration-300 flex flex-col items-center gap-3"
          [ngClass]="
            movementType() === 'ajuste'
              ? 'bg-sky-50 dark:bg-sky-950/30 border-sky-500 shadow-lg shadow-sky-100 dark:shadow-sky-950/20'
              : 'bg-stone-50 dark:bg-stone-800/50 border-stone-200 dark:border-stone-700 hover:border-stone-300 dark:hover:border-stone-600'
          "
        >
          <div
            class="w-14 h-14 rounded-xl flex items-center justify-center transition-all duration-300"
            [ngClass]="
              movementType() === 'ajuste'
                ? 'bg-sky-600 text-white'
                : 'bg-stone-200 dark:bg-stone-700 text-stone-500 dark:text-stone-400 group-hover:bg-stone-300 dark:group-hover:bg-stone-600'
            "
          >
            <span class="material-icons-outlined text-2xl">tune</span>
          </div>
          <div class="text-center">
            <p class="font-semibold text-stone-800 dark:text-stone-100">Ajuste</p>
            <p class="text-xs text-stone-500 dark:text-stone-400 mt-0.5">Corrección manual</p>
          </div>
          @if (movementType() === 'ajuste') {
          <div
            class="absolute -top-1 -right-1 w-6 h-6 bg-sky-600 rounded-full flex items-center justify-center"
          >
            <span class="material-icons-outlined text-white text-sm">check</span>
          </div>
          }
        </button>
      </div>
    </div>

    <!-- Producto (mejorado) -->
    <div class="space-y-2">
      <p class="text-xs text-stone-400 dark:text-stone-500 font-medium tracking-wide uppercase">
        Producto *
      </p>
      <select
        [(ngModel)]="selectedProductId"
        class="w-full px-4 py-3.5 bg-stone-50 dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 text-stone-900 dark:text-stone-100 transition-all duration-150 font-medium"
      >
        <option value="">Selecciona un producto</option>
        @for (product of products(); track product.id) {
        <option [value]="product.id">{{ product.name }} — Stock actual: {{ product.stock }}</option>
        }
      </select>
    </div>

    <!-- Cantidad y Motivo en grid -->
    <div class="grid grid-cols-2 gap-4">
      <div class="space-y-2">
        <p class="text-xs text-stone-400 dark:text-stone-500 font-medium tracking-wide uppercase">
          Cantidad *
        </p>
        <input
          type="number"
          [(ngModel)]="quantity"
          min="1"
          class="w-full px-4 py-3.5 bg-stone-50 dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 text-stone-900 dark:text-stone-100 transition-all duration-150 text-center text-lg font-bold"
        />
      </div>
      <div class="space-y-2">
        <p class="text-xs text-stone-400 dark:text-stone-500 font-medium tracking-wide uppercase">
          Motivo *
        </p>
        <input
          type="text"
          [(ngModel)]="reason"
          placeholder="Ej: Compra semanal"
          class="w-full px-4 py-3.5 bg-stone-50 dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 text-stone-900 dark:text-stone-100 transition-all duration-150 placeholder:text-stone-400"
        />
      </div>
    </div>

    <!-- Campos específicos para Entrada -->
    @if (movementType() === 'entrada') {
    <!-- Resumen de Costos estilo Zen -->
    <div
      class="p-5 rounded-2xl bg-stone-50 dark:bg-stone-800/50 border border-stone-100 dark:border-stone-700"
    >
      <p
        class="text-xs text-stone-400 dark:text-stone-500 font-medium tracking-wide uppercase mb-4"
      >
        Datos de Compra
      </p>

      <div class="grid grid-cols-2 gap-4 mb-4">
        <div class="space-y-2">
          <p class="text-xs text-stone-500 dark:text-stone-400">Proveedor</p>
          <input
            type="text"
            [(ngModel)]="supplier"
            placeholder="Nombre del proveedor"
            class="w-full bg-transparent border-none p-0 text-sm font-medium text-stone-800 dark:text-stone-200 focus:ring-0 placeholder:text-stone-400"
          />
        </div>
        <div class="space-y-2">
          <p class="text-xs text-stone-500 dark:text-stone-400">Factura/Boleta</p>
          <input
            type="text"
            [(ngModel)]="invoice"
            placeholder="Número de documento"
            class="w-full bg-transparent border-none p-0 text-sm font-medium text-stone-800 dark:text-stone-200 focus:ring-0 placeholder:text-stone-400"
          />
        </div>
      </div>

      <div class="pt-4 border-t border-stone-200 dark:border-stone-700 grid grid-cols-3 gap-4">
        <div class="space-y-1">
          <p class="text-xs text-stone-500 dark:text-stone-400">Costo Unitario</p>
          <div class="flex items-center gap-1">
            <span class="text-stone-400">S/</span>
            <input
              type="number"
              [(ngModel)]="cost"
              step="0.01"
              min="0"
              placeholder="0.00"
              class="w-full bg-transparent border-none p-0 text-lg font-semibold text-stone-700 dark:text-stone-300 focus:ring-0"
            />
          </div>
        </div>
        <div class="space-y-1 text-center">
          <p class="text-xs text-stone-500 dark:text-stone-400">Cantidad</p>
          <p class="text-lg font-bold text-stone-800 dark:text-stone-200">
            × {{ quantity() || 0 }}
          </p>
        </div>
        <div class="space-y-1 text-right">
          <p class="text-xs text-stone-500 dark:text-stone-400">Total Inversión</p>
          <p class="text-xl font-bold text-emerald-700 dark:text-emerald-500">
            S/ {{ (cost() || 0) * (quantity() || 0) | number : '1.2-2' }}
          </p>
        </div>
      </div>
    </div>
    }

    <!-- Notas (colapsable) -->
    <div class="space-y-2">
      <p class="text-xs text-stone-400 dark:text-stone-500 font-medium tracking-wide uppercase">
        Notas Adicionales
      </p>
      <textarea
        [(ngModel)]="notes"
        rows="2"
        placeholder="Información adicional sobre el movimiento..."
        class="w-full px-4 py-3 bg-stone-50 dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 text-stone-900 dark:text-stone-100 resize-none transition-all duration-150 placeholder:text-stone-400 text-sm"
      ></textarea>
    </div>
  </div>

  <!-- Footer Sticky con Gradiente -->
  <div
    class="sticky bottom-0 left-0 right-0 bg-linear-to-t from-white dark:from-stone-900 via-white dark:via-stone-900 to-transparent pt-6 pb-2 -mx-8 px-8 mt-8"
  >
    <div class="flex gap-4">
      <button
        type="button"
        (click)="closeDialog()"
        class="w-1/3 px-4 py-3.5 border border-stone-200 dark:border-stone-700 rounded-xl text-stone-700 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-800 transition-all duration-150 font-medium"
      >
        Cancelar
      </button>
      <button
        type="button"
        (click)="submitMovement()"
        class="w-2/3 px-4 py-3.5 bg-stone-900 dark:bg-stone-100 text-white dark:text-stone-900 rounded-xl hover:bg-black dark:hover:bg-white transition-all duration-150 font-semibold shadow-lg flex items-center justify-center gap-2"
      >
        <span class="material-icons-outlined text-lg">{{
          movementType() === 'entrada' ? 'add_circle' : 'check_circle'
        }}</span>
        {{ movementType() === 'entrada' ? 'Registrar Entrada' : 'Aplicar Ajuste' }}
      </button>
    </div>
  </div>
</app-ui-animated-dialog>
