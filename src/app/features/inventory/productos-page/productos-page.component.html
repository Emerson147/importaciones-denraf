<div class="min-h-screen bg-stone-50 dark:bg-stone-950 p-6 md:p-8 transition-colors duration-300">
  <div class="max-w-[1600px] mx-auto space-y-6">
    
    <!-- Header -->
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="text-4xl">ðŸ“¦</div>
        <div>
          <h1 class="text-3xl font-serif font-bold text-stone-800 dark:text-stone-100">Productos</h1>
          <p class="text-sm text-stone-500 dark:text-stone-400">Total: {{ products().length }} productos</p>
        </div>
      </div>
      <app-ui-button
        (onClick)="openCreate()"
        class="rounded-xl bg-stone-900 dark:bg-stone-100 hover:bg-black dark:hover:bg-stone-200 text-white dark:text-stone-900 px-6 shadow-lg"
      >
        <span class="flex items-center gap-2">
          <span class="material-icons-outlined text-sm">add</span>
          Nuevo Producto
        </span>
      </app-ui-button>
    </div>

    <!-- Grid de Productos -->
    <div class="bg-white dark:bg-stone-900 rounded-2xl border border-stone-100 dark:border-stone-800 shadow-sm overflow-hidden transition-colors duration-300">
      
      <!-- Barra de bÃºsqueda -->
      <div class="p-6 border-b border-stone-50 dark:border-stone-800 flex items-center justify-between">
        <div class="flex items-center gap-4 flex-1">
          <app-ui-input
            placeholder="Buscar producto o categorÃ­a..."
            class="max-w-md bg-stone-50 border-transparent rounded-xl"
            (valueChange)="searchQuery.set($event)"
          ></app-ui-input>
          
          <div class="flex items-center gap-2 text-xs text-stone-500 dark:text-stone-400">
            <span class="material-icons-outlined text-sm">filter_list</span>
            <span>{{ filteredProducts().length }} productos</span>
          </div>
        </div>
      </div>

      <!-- Grid de Productos (Vista Mejorada) -->
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
          
          @for (product of filteredProducts(); track product.id) {
            <div class="group bg-stone-50 rounded-2xl border border-stone-100 overflow-hidden hover:shadow-lg hover:border-stone-300 transition-all">
              
              <!-- Imagen del producto -->
              <div class="relative h-48 bg-stone-200 overflow-hidden">
                <img [src]="product.image" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" alt="">
                
                <!-- Badge de stock bajo -->
                @if (product.stock <= product.minStock) {
                  <div class="absolute top-2 right-2 bg-red-600/70 text-white text-xs font-bold px-2 py-1 rounded-lg flex items-center gap-1 shadow-lg">
                    <span class="material-icons-outlined text-xs">warning</span>
                    Stock Bajo
                  </div>
                }
                
                <!-- Nivel de stock visual -->
                <div class="absolute bottom-0 left-0 right-0 h-1 bg-black/20">
                  <div 
                    class="h-full transition-all duration-500"
                    [style.width.%]="(product.stock / 50) * 100"
                    [ngClass]="product.stock <= product.minStock ? 'bg-red-600/70' : 'bg-stone-600'"
                  ></div>
                </div>
              </div>

              <!-- Info del producto -->
              <div class="p-4 space-y-3">
                <div>
                  <p class="text-xs text-stone-400 uppercase tracking-wide font-medium">{{ product.category }}</p>
                  <h3 class="text-sm font-bold text-stone-800 line-clamp-1">{{ product.name }}</h3>
                  <p class="text-xs text-stone-400 font-mono mt-0.5">{{ product.id }}</p>
                </div>

                <!-- Stock -->
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-xs text-stone-500">Stock disponible</p>
                    <p class="text-lg font-bold text-stone-900 dark:text-stone-100">
                      {{ product.stock }} <span class="text-xs font-normal text-stone-400">und.</span>
                    </p>
                  </div>
                  
                  <div class="text-right">
                    <p class="text-xs text-stone-400">Margen</p>
                    <span class="text-xs font-bold text-emerald-700/70 dark:text-emerald-600/60 bg-emerald-50/20 dark:bg-emerald-950/10 px-2 py-1 rounded-full border border-emerald-200/30 dark:border-emerald-900/20">
                      {{ ((product.price - product.cost) / product.price) * 100 | number:'1.0-0' }}%
                    </span>
                  </div>
                </div>

                <!-- Precios -->
                <div class="flex items-center justify-between pt-3 border-t border-stone-200">
                  <div>
                    <p class="text-xs text-stone-400">Costo</p>
                    <p class="text-sm font-medium text-stone-600">S/ {{ product.cost | number:'1.2-2' }}</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-stone-400">Venta</p>
                    <p class="text-base font-bold text-stone-900">S/ {{ product.price | number:'1.2-2' }}</p>
                  </div>
                </div>

                <!-- Acciones -->
                <div class="flex gap-2 pt-2">
                  <button class="flex-1 h-9 rounded-lg bg-stone-900 hover:bg-black text-white text-xs font-medium transition-colors flex items-center justify-center gap-1">
                    <span class="material-icons-outlined text-sm">edit</span>
                    Editar
                  </button>
                  <button 
                    (click)="handleAction('delete', product.id)"
                    class="h-9 w-9 rounded-lg border border-stone-200 hover:border-stone-400 hover:bg-stone-100 text-stone-500 hover:text-stone-900 transition-colors flex items-center justify-center"
                  >
                    <span class="material-icons-outlined text-sm">delete</span>
                  </button>
                </div>
              </div>

            </div>
          }

        </div>
      </div>

    </div>

  </div>
</div>

<!-- Modal de Crear Producto -->
<app-ui-animated-dialog [isOpen]="isDialogOpen()" (isOpenChange)="isDialogOpen.set($event)">
  <div class="flex items-center justify-between mb-6 border-b border-stone-100 pb-4">
    <div>
      <h2 class="text-xl font-serif font-semibold text-stone-800">Nuevo Producto</h2>
      <p class="text-xs text-stone-400 font-medium tracking-wide uppercase">Agregar al inventario</p>
    </div>
    <div class="h-10 w-10 rounded-xl bg-stone-900 flex items-center justify-center text-white">
      <span class="material-icons-outlined text-lg">inventory_2</span>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
    <div class="md:col-span-5">
      <app-ui-label class="mb-2 block">FotografÃ­a del Producto</app-ui-label>
      <div
        (click)="fileInput.click()"
        class="relative group h-56 w-full rounded-2xl border-2 border-dashed border-stone-200 bg-stone-50 hover:bg-stone-100 transition-colors flex flex-col items-center justify-center cursor-pointer overflow-hidden"
      >
        <input
          #fileInput
          type="file"
          class="hidden"
          accept="image/*"
          (change)="onFileSelected($event)"
        />

        @if (selectedImage()) {
          <img [src]="selectedImage()" class="absolute inset-0 w-full h-full object-cover" alt="">
          <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
            <span class="text-white text-sm font-medium flex items-center gap-2">
              <span class="material-icons-outlined">edit</span>
              Cambiar imagen
            </span>
          </div>
        } @else {
          <div class="text-center group-hover:scale-105 transition-transform duration-300">
            <div class="mx-auto h-12 w-12 rounded-full bg-white shadow-sm flex items-center justify-center mb-3">
              <span class="material-icons-outlined text-stone-400 text-2xl">add_a_photo</span>
            </div>
            <p class="text-sm text-stone-600 font-medium">Click para subir</p>
            <p class="text-xs text-stone-400 mt-1">JPG, PNG â€¢ Max 2MB</p>
          </div>
        }
      </div>
    </div>

    <div class="md:col-span-7 space-y-4">
      <div class="space-y-1.5">
        <app-ui-label>Nombre del Producto</app-ui-label>
        <app-ui-input
          [value]="productName()"
          (valueChange)="updateName($event)"
          placeholder="Ej: Casaca Bomber Negra"
          class="bg-stone-50 border-transparent"
        ></app-ui-input>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div class="space-y-1.5">
          <app-ui-label>CategorÃ­a</app-ui-label>
          <select class="flex h-10 w-full rounded-lg border border-transparent bg-stone-50 px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stone-900">
            <option value="Casacas">Casacas</option>
            <option value="Pantalones">Pantalones</option>
            <option value="Polos">Polos</option>
            <option value="Accesorios">Accesorios</option>
          </select>
        </div>
        
        <div class="space-y-1.5">
          <app-ui-label>Stock Inicial</app-ui-label>
          <app-ui-input
            type="number"
            [value]="initialStock().toString()"
            (valueChange)="updateStock($event)"
            placeholder="0"
            class="bg-stone-50 border-transparent text-center font-bold"
          ></app-ui-input>
        </div>
      </div>

      <div class="space-y-2">
        <app-ui-label>Tallas Disponibles</app-ui-label>
        <div class="flex gap-2">
          @for (size of ['S', 'M', 'L', 'XL']; track size) {
            <button
              (click)="selectedSize.set(size)"
              class="h-10 w-10 rounded-lg border text-sm font-bold transition-all"
              [ngClass]="selectedSize() === size ? 'bg-stone-900 text-white border-stone-900 shadow-md' : 'bg-white border-stone-200 hover:border-stone-900'"
            >
              {{ size }}
            </button>
          }
        </div>
      </div>
    </div>
  </div>

  <div class="mt-6 p-5 rounded-2xl bg-stone-50 border border-stone-100 grid grid-cols-3 gap-6">
    <div class="space-y-2">
      <app-ui-label class="text-xs uppercase text-stone-400">Costo Unitario (S/)</app-ui-label>
      <input
        type="number"
        placeholder="0.00"
        (input)="updateCost($any($event.target).value)"
        class="w-full bg-transparent border-none p-0 text-base font-semibold text-stone-600 focus:ring-0 placeholder:text-stone-300"
      />
    </div>
    
    <div class="space-y-2 pl-6 border-l border-stone-200">
      <app-ui-label class="text-xs uppercase text-stone-400">Precio Venta (S/)</app-ui-label>
      <input
        type="number"
        placeholder="0.00"
        (input)="updateSale($any($event.target).value)"
        class="w-full bg-transparent border-none p-0 text-xl font-bold text-stone-900 focus:ring-0 placeholder:text-stone-300"
      />
    </div>
    
    <div class="space-y-2 text-right">
      <p class="text-xs uppercase text-stone-400 font-medium">Ganancia</p>
      <p class="text-lg font-bold text-emerald-600/70 dark:text-emerald-600/60">+ S/ {{ profit() | number:'1.2-2' }}</p>
      <p class="text-xs font-medium text-emerald-700/70 dark:text-emerald-600/60 bg-emerald-50/20 dark:bg-emerald-950/10 px-2 py-1 rounded-full inline-block">
        {{ margin() }}% margen
      </p>
    </div>
  </div>

  <div class="mt-6 flex gap-3">
    <app-ui-button
      variant="outline"
      class="w-1/3 border-stone-200 rounded-xl"
      (onClick)="isDialogOpen.set(false)"
    >
      Cancelar
    </app-ui-button>
    <app-ui-button 
      class="w-2/3 bg-stone-900 hover:bg-black text-white rounded-xl shadow-lg" 
      (onClick)="saveProduct()"
    >
      Guardar Producto
    </app-ui-button>
  </div>
</app-ui-animated-dialog>
